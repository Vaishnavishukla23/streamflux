<div class="container">
  <h2 class="heading">Device Data for ID: {{ deviceId }}</h2>

  <!-- Button to toggle between table and graph -->
  <button (click)="toggleView()" class="btn btn-primary toggle-button">
    Switch to {{ showTable ? 'Graph' : 'Table' }}
  </button>

  <!-- Toggle button to switch between mock and real data -->
  <button (click)="toggleData()" class="btn btn-secondary toggle-button">
    {{ isUsingMockData ? 'Switch to Real Data' : 'Switch to Mock Data' }}
  </button>

  <!-- Conditionally show either the table or the graph based on showTable -->
  <div *ngIf="showTable; else graphView">
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>Device ID</th>
            <th>Live Temperature</th>
            <th>Live Humidity</th>
            <th>Live Water Level</th>
            <th>Timestamp</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ live_data.device_id }}</td>
            <td>{{ live_data.temperature | number : '1.2-2' }} C</td>
            <td>{{ live_data.humidity | number : '1.2-2' }}%</td>
            <td>{{ live_data.water_level }}</td>
            <td>{{ live_data.timestamp | date:'long' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <br>
    <hr>
    <br>

    <!-- Error message display -->
    <div *ngIf="errorMessage" class="alert alert-danger">
      <strong>Error: </strong>{{ errorMessage }}
    </div>

    <!-- Table to display historical data -->
   <!-- Historical data table -->
<div class="table-responsive" *ngIf="data.length > 0; else noData">
  <table class="table table-hover">
    <thead>
      <tr>
        <th>Device ID</th>
        <th>Temperature</th>
        <th>Humidity</th>
        <th>Water Level</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of data | paginate: { itemsPerPage: 15, currentPage: p }">
        <td>{{ item.device_id }}</td>
        <td>{{ item.temperature | number : '1.2-2' }} C</td>
        <td>{{ item.humidity | number : '1.2-2' }}%</td>
        <td>{{ item.water_level }}</td>
        <td>{{ item.timestamp | date:'long' }}</td>
      </tr>
    </tbody>
  </table>
  
  <!-- Pagination Controls -->
  <pagination-controls (pageChange)="p = $event"></pagination-controls>
</div>

<!-- Fallback when no data is available -->
<ng-template #noData>
  <div class="alert alert-info no-data-alert">
    <p>No data available for the selected device.</p>
  </div>
</ng-template>

    <!-- Fallback when no data is available -->
    <ng-template #noData>
      <div class="alert alert-info no-data-alert">
        <p>No data available for the selected device.</p>
      </div>
    </ng-template>
  </div>

  <!-- Chart view -->
  <ng-template #graphView>
    <div class="myChartWrapper">
    <div style="display: block;" class="myChart">
      <canvas baseChart
              [data]="chartData"
              [options]="chartOptions"
              [type]="scatterChartType">
      </canvas>
    </div>
  </div>
  </ng-template>
</div>
